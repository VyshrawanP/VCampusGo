<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Student Utility Portal</title>

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="css/style.css">




  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2563eb">
</head>

<body>

  <!-- ================= HEADER / FACULTY FINDER ================= -->
  <header class="header">
    <h1>Faculty Finder</h1>
    <p class="subtitle">
      â€œAn unofficial student-to-student helper â€” built only to make campus life easier.â€
    </p>

    <div class="search-container">
      <input
        type="text"
        id="facultySearch"
        placeholder="Find faculty"
        autocomplete="off"
      />
    </div>
  </header>

  <!-- ================= FACULTY RESULTS ================= -->
  <main class="main-content">
    <section class="faculty-section">
      <div id="facultyResults" class="faculty-grid">
        <!-- Faculty cards injected via JS -->
      </div>
    </section>

    <!-- ================= MESS MENU ================= -->
    <section class="mess-section">
      <h2>Todayâ€™s Mess Menu</h2>
      <p id="messMeta" class="mess-meta">
        <!-- Hostel Â· Month Year -->
      </p>

      <div id="messCards" class="mess-grid">
        <!-- Meal cards injected via JS -->
      </div>

      <button id="notifyBtn" class="notify-btn">
        Enable todayâ€™s meal notifications
      </button>
    </section>
  </main>

  <!-- ================= FOOTER ================= -->
  <footer class="footer">
    <p>Developed by Vyshrawan P</p>
    <p class="footer-sub">Student project Â· Unofficial</p>
  </footer>

  <!-- ================= JS ================= -->
  <script src="js/faculty.js"></script>
  <script src="js/mess.js"></script>
  <script src="js/notifications.js"></script>
  <script src="js/main.js"></script>

</body>
</html>



const notifyBtn = document.getElementById("notifyBtn");

notifyBtn.addEventListener("click", async () => {
  if (!("serviceWorker" in navigator)) {
    alert("Service workers not supported");
    return;
  }

  const permission = await Notification.requestPermission();
  if (permission !== "granted") {
    alert("Notifications denied");
    return;
  }

  const reg = await navigator.serviceWorker.ready;

  const subscription = await reg.pushManager.subscribe({
    userVisibleOnly: true,
    applicationServerKey: urlBase64ToUint8Array("YOUR_PUBLIC_VAPID_KEY")
  });

window.testMorning = () => {
  sendMorningNotification();
};

function sendMorningNotification() {
  navigator.serviceWorker.ready.then(reg => {
    reg.showNotification("ğŸŒ… Good Morning", {
      body: "Breakfast will be available soon"
    });
  });
  // time check logic
function checkMorningNotification() {
  // time checks here
}

// run on load
checkMorningNotification();
  await fetch("/api/subscribe", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(subscription)
  });

  alert("Meal notifications enabled");
});


function urlBase64ToUint8Array(base64String) {
  const padding = "=".repeat((4 - base64String.length % 4) % 4);
  const base64 = (base64String + padding)
    .replace(/-/g, "+")
    .replace(/_/g, "/");

  const raw = atob(base64);
  return Uint8Array.from([...raw].map(c => c.charCodeAt(0)));
}
